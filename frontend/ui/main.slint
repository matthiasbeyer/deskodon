import { Button, HorizontalBox } from "std-widgets.slint";

import { MenuBar } from "menubar.slint";
import { SideBar } from "sidebar.slint";

import { AboutPage } from "pages/about.slint";
import { LoadingPage } from "pages/loading.slint";
import { LoginPage } from "pages/login.slint";
import { AuthorizationUrlPage } from "pages/authorization.slint";
import { MainPage } from "pages/main.slint";
import { MyProfilePage } from "pages/my_profile.slint";
import { SettingsPage } from "pages/settings.slint";

export component GuiMain inherits Window {
    title: "deskodon";
    background: gray;

    preferred-width: 100%;
    preferred-height: 100%;

    in property <bool> loaded;
    in property <bool> loggedin;
    in property <bool> display_authorization;
    in property <string> authorization_url;


    callback login <=> login_page.login;
    callback notify_gui_booted();

    init => {
        notify_gui_booted()
    }

    callback show_login_page();
    show_login_page() => {
        login_page.visible = true;
        authorization_display_page.visible = false;
        loading_page.visible = false;
    }

    callback show_authorization_page(string);
    show_authorization_page(url) => {
        login_page.visible = false;
        authorization_display_page.url = url;
        authorization_display_page.visible = true;
        loading_page.visible = false;
    }

    callback show_loading_page();
    show_loading_page() => {
        login_page.visible = false;
        authorization_display_page.visible = true;
        loading_page.visible = true;
    }

    VerticalLayout {
        spacing: 5px;
        preferred-width: 100%;
        preferred-height: 100%;

        login_page := LoginPage {
            visible: false;
        }

        authorization_display_page := AuthorizationUrlPage {
            visible: false;
        }

        loading_page := LoadingPage {
            visible: false;
        }

        MenuBar {
            visible: false;
            Text {
                text: "deskodon";
            }

            Button {
                text: "Click!";
                // does nothing
            }

            Button {
                text: "Me!";
                // does nothing
            }
        }


        HorizontalBox {
            visible: loggedin && loaded;

            spacing: 5px;
            preferred-width: 1200px;
            preferred-height: 800px;

            Rectangle {
                min-width: 10px;
                max-width: 50px;
                // spacing
            }

            side-bar := SideBar {
                title: "";
                model: [
                    "Main",
                    "My Profile",
                    "Settings",
                    "About",
                ];
            }

            Rectangle {
                clip: true;
                main-page := MainPage {
                    x: side-bar.current-item == 0 ? 0 : side-bar.current-item < 0 ? - self.width - 1px : parent.width + 1px;
                    animate x { duration: 125ms; easing: ease; }
                }

                profile-page := MyProfilePage {
                    x: side-bar.current-item == 1 ? 0 : side-bar.current-item < 1 ? - self.width - 1px : parent.width + 1px;
                    animate x { duration: 125ms; easing: ease; }
                }

                settings-page := SettingsPage {
                    x: side-bar.current-item == 2 ? 0 : side-bar.current-item < 2 ? - self.width - 1px : parent.width + 1px;
                    animate x { duration: 125ms; easing: ease; }
                }

                about-page := AboutPage {
                    x: side-bar.current-item == 3 ? 0 : side-bar.current-item < 3 ? - self.width - 1px : parent.width + 1px;
                    animate x { duration: 125ms; easing: ease; }
                }
            }
        }
    }

}
